{% extends "layout.html.twig" %}

{% block title %}{{ billet.title }}{% endblock %}

{% block content %}
{% for flashMessage in app.session.flashbag.get('success') %}
	<div class="alert alert-success">
		{{ flashMessage }}
	</div>
{% endfor %}

<div class="row">
	<div class="col-sm-12">
		<h2>{{ billet.title }}</h2>
	</div>
	<div class="col-sm-10 col-sm-offset-2">
		<div class="img-billet">
		 	<img class="img-responsive" src="{{ asset(billet.img) }}" alt="gnou">
		 </div>
	</div>
	<div class="col-sm-8 col-sm-offset-2">
	{{ billet.content | raw }}
	</div>
	<div class="col-sm-8 col-sm-offset-2" id="blockComment">
	<h2>Commentaires</h2>
		<div class="row" id="commentBtn">
			<div class="col-sm-4">	
				<button type ="button" class="btn btn-primary" value="Commenter" data-toggle="collapse" data-target="#publishComment"><span class="fa fa-comment fa-2x"></span> Commenter</button>
			</div>			

			<div id="publishComment" class="col-sm-9 collapse">							
				<form name="publishForm" action="{{ path('comment_add', {'idParent': 'null', 'billetId': billet.id}) }}" method="post">
					<div class="form-group">
						<input type="text" class="form-control" rows="4" name="publishFormPseudo" placeholder="Votre pseudo...">
					</div>
					<div class="form-group">
						<textarea type="text" class="form-control" rows="4" name="publishFormContent" placeholder="Votre commentaire..."></textarea>
					</div>
					<div class="form-group">
						<input type="submit" class="btn btn-primary" value="Publier">
					</div>
				</form>						
			</div>		
		</div>
	{% block comment %}
		<div class="row">			
		{% for comment in comments %}
			<div class="col-sm-12">
				<div class="panel panel-info">
					<div class="panel-body">
					{{ comment.content }}
					</div>
					<div class="panel-heading">
						<div class="row">
							<div class="col-sm-4 col-xs-4">
								<div class="panel-title">
								<em>{{ comment.author}}</em>
								</div>
							</div>

							<div class="col-sm-4 col-xs-4 col-sm-offset-4 col-xs-offset-2">	
								<div class="btn-group">
								<a href="#" class="btn btn-primary btn-xs" value="Repondre" data-toggle="collapse" data-target="#{{ comment.id }}"><span class="fa fa-comments"></span> Repondre</a>									
								<a href="{{ path('comment_report', { 'id': comment.id, 'billetId': billet.id }) }}" class="btn btn-danger btn-xs" value="Signaler"><span class="fa fa-thumbs-down lg"></span> Signaler</a>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<div id="{{ comment.id }}" class="col-sm-9 collapse">
						<form name="answerForm{{ comment.id }}" action="{{ path('comment_add', {'idParent': comment.id, 'billetId': billet.id}) }}" method="post">
							<div class="form-group">
								<input type="text" class="form-control" rows="4" name="answerFormPseudo{{ comment.id }}" placeholder="Votre pseudo...">
							</div>
							<div class="form-group">
								<textarea type="text" class="form-control" rows="4" name="answerFormContent{{ comment.id }}" placeholder="Votre commentaire..."></textarea>
							</div>
							<div class="form-group">
								<input type="submit" class="btn btn-primary" value="Publier">
							</div>
						</form>											
					</div>		
				</div>

				<div class="row">
				{% for childComment in comment.children %}
					<div class="col-xs-offset-1 col-xs-11">		
						<div class="panel panel-info">
							<div class="panel-body">
							{{ childComment.content }}
							</div>
							<div class="panel-heading">
								<div class="row">
									<div class="col-sm-4 col-xs-2">
										<div class="panel-title">
										<em>{{ childComment.author}}</em>
										</div>
									</div>
									<div class="col-sm-4 col-xs-6 col-sm-offset-4 col-xs-offset-4">	
										<div class="btn-group">
										<a href="#" class="btn btn-primary btn-xs" value="Repondre" data-toggle="collapse" data-target="#{{ childComment.id }}"><span class="fa fa-comments"></span> Repondre</a>									
										<a href="{{ path('comment_report', { 'id': childComment.id, 'billetId': billet.id }) }}" class="btn btn-danger btn-xs" value="Signaler"><span class="fa fa-thumbs-down lg"></span> Signaler</a>
										</div>
									</div>
								</div>
							</div>
						</div>							
						<div class="row">									
							<div id="{{ childComment.id }}" class="col-sm-9 collapse">
								<form name="answerForm{{ childComment.id }}" action="{{ path('comment_add', {'idParent': childComment.id, 'billetId': billet.id}) }}" method="post">
									<div class="form-group">
										<input type="text" class="form-control" rows="4" name="answerFormPseudo{{ childComment.id }}" placeholder="Votre pseudo...">
									</div>
									<div class="form-group">
										<textarea type="text" class="form-control" rows="4" name="answerFormContent{{ childComment.id }}" placeholder="Votre commentaire..."></textarea>
									</div>
									<div class="form-group">
										<input type="submit" class="btn btn-primary" value="Publier">
									</div>
								</form>																	
							</div>
						</div>		
						<div class="row">	
						{% for subChildComment in childComment.children %}					
							<div class="col-xs-offset-1 col-xs-11">
								<div class="panel panel-info">
									<div class="panel-body">
									{{ subChildComment.content }}
									</div>
									<div class="panel-heading">
										<div class="row">
											<div class="col-sm-4 col-xs-4">
												<div class="panel-title">
												<em>{{ subChildComment.author}}</em>
												</div>
											</div>
											<div class="col-sm-2 col-sm-offset-5 col-xs-2">
												<a href="{{ path('comment_report', { 'id': comment.id, 'billetId': billet.id }) }}">
												<button type="button" class="btn btn-danger btn-xs" value="Signaler"><span class="fa fa-thumbs-down lg"></span> Signaler</button></a>
											</div>
										</div>
									</div>
								</div>
							</div>		
						{% endfor %}					
						</div>
					</div>				
				{% endfor %}
				</div>		
			</div>	
		{% else %}
			Pas encore de commentaires.			
		{% endfor %}
		</div>
	{% endblock %}
	</div>

{% endblock %}
